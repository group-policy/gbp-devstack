[[local|localrc]]

ENABLE_NFP=True
NFP_DEVSTACK_MODE=base

# Edit NFP_DEVSTACK_MODE with either 'base' or 'advanced'
if [[ $ENABLE_NFP = True ]]; then

    if [[ $NFP_DEVSTACK_MODE = advanced ]]; then
        # External Network
        EXT_NET_GATEWAY=
        EXT_NET_ALLOCATION_POOL_START=
        EXT_NET_ALLOCATION_POOL_END=
        EXT_NET_CIDR=

        # Configurator image path option, its optional
        # If configured, install step uploads the specified image
        # If not configured, install step will build a new one and upload it
        ConfiguratorQcow2Image=
        # Service VM image path options, they are optional
        # If configured, install step uploads the specified images
        # If not configured, install step ignores uploading these service images
        VyosQcow2Image=
        HaproxyQcow2Image=

        # Make sure that your public interface is not attached to any bridge.
        PUBLIC_INTERFACE=
    fi
fi

DATABASE_PASSWORD=abc123
ADMIN_PASSWORD=abc123
MYSQL_PASSWORD=$DATABASE_PASSWORD
RABBIT_PASSWORD=abc123
SERVICE_PASSWORD=$ADMIN_PASSWORD
SERVICE_TOKEN=abc123

Q_SERVICE_PLUGIN_CLASSES=neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,group_policy,ncp

# Using group-policy branches
# ---------------------------

GIT_BASE=http://github.com

GBPSERVICE_REPO=${GIT_BASE}/openstack/group-based-policy.git
GBPSERVICE_BRANCH=stable/liberty
#GBPSERVICE_REPO=https://review.openstack.org/openstack/group-based-policy
#GBPSERVICE_BRANCH=refs/changes/54/240954/51

GBPCLIENT_REPO=${GIT_BASE}/openstack/python-group-based-policy-client.git
GBPCLIENT_BRANCH=stable/liberty
#GBPCLIENT_REPO=https://review.openstack.org/openstack/python-group-based-policy-client
#GBPCLIENT_BRANCH=refs/changes/73/261773/2

GBPUI_REPO=${GIT_BASE}/openstack/group-based-policy-ui.git
GBPUI_BRANCH=stable/liberty
#GBPUI_REPO=https://review.openstack.org/openstack/group-based-policy-ui
#GBPUI_BRANCH=refs/changes/52/262852/2

GBPHEAT_REPO=${GIT_BASE}/openstack/group-based-policy-automation.git
GBPHEAT_BRANCH=stable/liberty
#GBPHEAT_REPO=https://review.openstack.org/openstack/group-based-policy-automation
#GBPHEAT_BRANCH=refs/changes/55/262855/1

# Enable neutron for group-policy-poc
# -----------------------------------
disable_service n-net
enable_service n-novnc
enable_service q-svc
enable_service q-agt
enable_service q-dhcp
enable_service q-l3
enable_service q-fwaas
if [[ $ENABLE_NFP = True ]]; then
    [[ $NFP_DEVSTACK_MODE = advanced ]] && enable_plugin neutron-vpnaas https://git.openstack.org/openstack/neutron-vpnaas stable/liberty
fi
enable_service q-lbaas
enable_service q-meta
enable_service neutron
enable_service group-policy
disable_service tempest
ENABLED_SERVICES+=,heat,h-api,h-api-cfn,h-api-cw,h-eng
if [[ $ENABLE_NFP = True ]]; then
    # NFP services
    enable_service nfp_orchestrator
    enable_service nfp_proxy
    enable_service nfp_proxy_agent
    [[ $NFP_DEVSTACK_MODE = base ]] && enable_service nfp_base_configurator
    [[ $NFP_DEVSTACK_MODE = advanced ]] && enable_service nfp_config_orchestrator
fi

OVS_PHYSICAL_BRIDGE=br-ex

DEST=/opt/stack
SCREEN_LOGDIR=$DEST/logs/screen
LOGFILE=$DEST/logs/stack.sh.log
SKIP_EXERCISES=volumes,trove,swift,sahara,euca,bundle,boot_from_volume,aggregates,zaqar,client-env,neutron-adv-test,floating_ips,client-args,horizon,sec_groups,gbp_servicechain,gbp_heat

#OFFLINE=True

# Group-based Policy configuration
# Comment the lines below if you don't want to configure the datapath
# and use the dummy driver.
# Group-based Policy configuration
# Comment the lines below if you don't want to configure the datapath
# and use the dummy driver.
[[post-config|/etc/nova/nova.conf]]
[neutron]
allow_duplicate_networks = True

[[post-config|/etc/heat/heat.conf]]
[DEFAULT]
plugin_dirs=/opt/stack/gbpautomation/gbpautomation/heat

[[post-config|/etc/neutron/neutron.conf]]
[group_policy]
policy_drivers=implicit_policy,resource_mapping
extension_drivers=proxy_group

[servicechain]
servicechain_drivers = simplechain_driver
#servicechain_drivers = chain_with_two_arm_appliance_driver

[quotas]
default_quota = -1
quota_network = -1
quota_subnet = -1
quota_port = -1
quota_security_group = -1
quota_security_group_rule = -1
quota_router = -1
quota_floatingip = -1

[[post-config-gbp|/etc/neutron/neutron.conf]]
[node_composition_plugin]
node_plumber = stitching_plumber
node_drivers = heat_node_driver

[[post-config-nfp|/etc/neutron/neutron.conf]]
[keystone_authtoken]
admin_tenant_name = service
admin_user = neutron
admin_password = $ADMIN_PASSWORD

[node_composition_plugin]
node_plumber = admin_owned_resources_apic_plumber
node_drivers = nfp_node_driver

[admin_owned_resources_apic_tscp]
plumbing_resource_owner_user = neutron
plumbing_resource_owner_password = $ADMIN_PASSWORD
plumbing_resource_owner_tenant_name = service

[group_policy_implicit_policy]
default_external_segment_name = default

[nfp_node_driver]
is_service_admin_owned = True
svc_management_ptg_name = svc_management_ptg

